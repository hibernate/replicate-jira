# General Quarkus config:
#
# So that we have /api prefix in all our REST paths:
quarkus.rest.path=/api
# Jira projects config:
#
# Hibernate projects group (https://hibernate.atlassian.net)
# Set of common configurations for the entire group:
jira.project-group."hibernate".scheduled.cron=${JIRA_SCHEDULED_CRON_HIBERNATE:off}
jira.project-group."hibernate".source.api-uri=${JIRA_API_URL_HIBERNATE:https://hibernate.atlassian.net/rest/api/2}
jira.project-group."hibernate".source.api-user.email=${JIRA_API_USER_HIBERNATE}
jira.project-group."hibernate".source.api-user.token=${JIRA_API_TOKEN_HIBERNATE}
jira.project-group."hibernate".destination.api-uri=${JIRA_API_URL_REDHAT:https://hibernate.atlassian.net/rest/api/2}
jira.project-group."hibernate".destination.login-kind=BEARER_TOKEN
jira.project-group."hibernate".destination.api-user.email=${JIRA_API_USER_REDHAT}
jira.project-group."hibernate".destination.api-user.token=${JIRA_API_TOKEN_REDHAT}
jira.project-group."hibernate".can-set-reporter=true
#
# Management endpoints:
quarkus.management.enabled=true
quarkus.management.auth.basic=true
quarkus.management.auth.permission.sync.policy=authenticated
quarkus.management.auth.permission.sync.paths=/q/sync/*
quarkus.management.auth.permission.health.policy=permit
quarkus.management.auth.permission.health.paths=/q/health/*
#
# Basic security for management:
quarkus.security.users.embedded.enabled=true
quarkus.security.users.embedded.plain-text=true
quarkus.security.users.embedded.users."management-user"=${MANAGEMENT_USER_PASSWORD}
#
# Processing queue configuration:
processing.events.queue-size=${PROCESSING_QUEUE_SIZE:1000}
#
# Scheduler:
# >> By default, the scheduler is not started unless a @Scheduled business method is found.
# >> You may need to force the start of the scheduler for "pure" programmatic scheduling via quarkus.scheduler.start-mode=forced
quarkus.scheduler.start-mode=forced
# List of users we expect to map between instances.
# We use ids as other means like email/name etc may be unreliable (email may not be accessible if user decided to hide it)
#
# On Red Hat side:
#    Search for user at RH jira with https://issues.redhat.com/rest/api/2/user/search?username=rh-ee-mbekhta
# On Hibernate side:
# Search for a user at https://hibernate.atlassian.net/jira/people/search
# Just open a user profile and get the ID from the URl: https://hibernate.atlassian.net/jira/people/557058:18cf44bb-bc9b-4e8d-b1b7-882969ddc8e5
#
%prod,test.jira.project-group."hibernate".users.mapped-property-name=name
# Yoann:
%dev.jira.project-group."hibernate".users.mapping."557058\:58fa1ced-171a-4c00-97e8-5d70d442cc4b"=557058:58fa1ced-171a-4c00-97e8-5d70d442cc4b
%prod,test.jira.project-group."hibernate".users.mapping."557058\:58fa1ced-171a-4c00-97e8-5d70d442cc4b"=rh-ee-yrodiere
# Marko:
%dev.jira.project-group."hibernate".users.mapping."557058\:18cf44bb-bc9b-4e8d-b1b7-882969ddc8e5"=557058:18cf44bb-bc9b-4e8d-b1b7-882969ddc8e5
%prod,test.jira.project-group."hibernate".users.mapping."557058\:18cf44bb-bc9b-4e8d-b1b7-882969ddc8e5"=rh-ee-mbekhta
# Steve
%prod,test.jira.project-group."hibernate".users.mapping."557058\:aafa2e9a-7a21-4c62-bf4a-050acb31276c"=sebersol
# Martin
%prod,test.jira.project-group."hibernate".users.mapping."5cff634e0ca4470c59b24c1e"=mmarcian
# Andrea
%prod,test.jira.project-group."hibernate".users.mapping."557058\:8ce9ebec-e8f7-4cb9-b414-ea2ae49591e3"=aboriero
# Marco
%prod,test.jira.project-group."hibernate".users.mapping."712020\:dcf258b4-84bc-4e85-a34f-054b5ac2d0d1"=mbellade
%prod,test.jira.project-group."hibernate".users.mapping."637b480e9e48f2b9a6119795"=mbellade
# Guillaume
%prod,test.jira.project-group."hibernate".users.mapping."557058\:71e31052-f0d7-46e3-a9d7-8b9acd6998d8"=guillaume.smet
## Gunnar
#%prod,test.jira.project-group."hibernate".users.mapping."557058\:6a9959ae-3b15-4370-ad41-e78c978f4f7b"=gunnar.morling
# Sanne
# or JIRAUSER247447
%prod,test.jira.project-group."hibernate".users.mapping."557058\:99e61e65-956b-4a21-b29c-06057642e9ea"=sgrinove@redhat.com
%prod,test.jira.project-group."hibernate".users.mapping."557058\:690dd548-c602-4a58-9c7e-0923346f4e97"=sgrinove@redhat.com
%prod,test.jira.project-group."hibernate".users.mapping."70121\:05895251-ccc4-42d9-acf3-7800fcf17a4c"=sgrinove@redhat.com
%prod,test.jira.project-group."hibernate".users.mapping."557058\:f781de72-2c68-4904-9be1-937e6dcca29f"=sgrinove@redhat.com
## Emmanuel
#%prod,test.jira.project-group."hibernate".users.mapping."557058\:7146ccce-8d92-4967-a2e1-f09ff06cc122"=rhn-engineering-ebernard
#%prod,test.jira.project-group."hibernate".users.mapping."557058\:60723d35-67e0-400b-9749-abf4e657a6bd"=rhn-engineering-ebernard
# Scott
%prod,test.jira.project-group."hibernate".users.mapping."557058\:ff72c345-4c9e-4140-98cc-5cd4fedbdfac"=smarlow1@redhat.com
%prod,test.jira.project-group."hibernate".users.mapping."557058\:3cb286d0-7d8f-47ff-a3f8-c8cc6a2016f3"=smarlow1@redhat.com
%prod,test.jira.project-group."hibernate".users.mapping."557058\:db1a3420-e3e5-4207-9989-5d434a8152e9"=smarlow1@redhat.com
%prod,test.jira.project-group."hibernate".users.mapping."557058\:9c00e014-1754-4b71-9606-dab4e465c26c"=smarlow1@redhat.com
# Christian
%prod,test.jira.project-group."hibernate".users.mapping."557058\:0222998d-a0c8-4789-91ec-6a92d10dfb9a"=cbeikov@redhat.com
# Koen
%prod,test.jira.project-group."hibernate".users.mapping."557058\:926ec7e6-0515-4337-a65b-32fd943f79ca"=kaers@redhat.com
# Fabio
%prod,test.jira.project-group."hibernate".users.mapping."602700e4b9d00300709fe7d1"=fercoli@redhat.com
# Jan
%prod,test.jira.project-group."hibernate".users.mapping."557058\:d2e3c0d7-28e0-4bde-9d33-5380e446ab06"=jschatte@redhat.com
# Davide
%prod,test.jira.project-group."hibernate".users.mapping."557058\:dc17d3f8-d34a-4a8a-a552-704e1902d0ae"=ddalto@redhat.com
## Gavin
#jira.project-group."hibernate".users.mapping."557058\:c227967f-4207-4715-82ea-1c48a845aea1"=
###########################################################################
# Issue types:
jira.project-group."hibernate".issue-types.default-value=3
jira.project-group."hibernate".priorities.default-value=3
jira.project-group."hibernate".statuses.default-value=1
jira.project-group."hibernate".issue-link-types.default-value=10011
jira.project-group."hibernate".issue-link-types.parent-link-type=10011
jira.project-group."hibernate".users.default-value=-1

# Issue link types:
%prod.jira.project-group."hibernate".issue-link-types.default-value=12310001
# Depend
%prod.jira.project-group."hibernate".issue-link-types.parent-link-type=12311220
# Blocks: is blocked by
%prod.jira.project-group."hibernate".issue-link-types.mapping."10100"=12310720
%prod.jira.project-group."hibernate".issue-link-types.mapping."10101"=12310720
%prod.jira.project-group."hibernate".issue-link-types.mapping."10102"=12310720
# Cause: caused by
%prod.jira.project-group."hibernate".issue-link-types.mapping."10050"=12310220
# Cloners: cloned from
%prod.jira.project-group."hibernate".issue-link-types.mapping."10030"=12310120
# Documentation: documented by
%prod.jira.project-group."hibernate".issue-link-types.mapping."10060"=12310420
# Duplicate: is duplicated by
%prod.jira.project-group."hibernate".issue-link-types.mapping."10000"=12310000
# Fix: is fixed by -> Related
%prod.jira.project-group."hibernate".issue-link-types.mapping."10010"=12310001
# Follow Up: is followed up by -> Related
%prod.jira.project-group."hibernate".issue-link-types.mapping."10070"=12310001
# Prerequisite: required for -> Related
%prod.jira.project-group."hibernate".issue-link-types.mapping."10020"=12310001
# Relates: relates to -> Related
%prod.jira.project-group."hibernate".issue-link-types.mapping."10011"=12310001
#
#
# Issue types:
# Scheme OJA-ITS-002 defines only these:
#
# Bug 1
# Epic 16
# Risk 11406
# Story 17
# Sub-task 5
# Task 3
# Vulnerability 12207
# Weakness 12206
#
# Task
%prod.jira.project-group."hibernate".issue-types.default-value=3
# bug -> bug
%prod.jira.project-group."hibernate".issue-types.mapping."1"=1
%prod.jira.project-group."hibernate".issue-types.mapping."10054"=1
# New Feature -> Story
%prod.jira.project-group."hibernate".issue-types.mapping."2"=17
# Task -> Task
%prod.jira.project-group."hibernate".issue-types.mapping."3"=3
# Improvement -> Story
%prod.jira.project-group."hibernate".issue-types.mapping."4"=17
# Patch -> Task
%prod.jira.project-group."hibernate".issue-types.mapping."5"=3
# Deprecation -> Task
%prod.jira.project-group."hibernate".issue-types.mapping."6"=3
# Sub-task -> Task
%prod.jira.project-group."hibernate".issue-types.mapping."7"=3
# Remove Feature -> Task
%prod.jira.project-group."hibernate".issue-types.mapping."8"=3
# Epic -> Epic
%prod.jira.project-group."hibernate".issue-types.mapping."9"=16
# Story -> Story
%prod.jira.project-group."hibernate".issue-types.mapping."10"=17
# Technical task -> Task
%prod.jira.project-group."hibernate".issue-types.mapping."11"=3
# Task -> Task
%prod.jira.project-group."hibernate".issue-types.mapping."10019"=3
# Epic -> Epic
%prod.jira.project-group."hibernate".issue-types.mapping."10020"=16
# Subtask -> Task
%prod.jira.project-group."hibernate".issue-types.mapping."10021"=3
# Story -> Story
%prod.jira.project-group."hibernate".issue-types.mapping."10052"=17
# Task -> Task
%prod.jira.project-group."hibernate".issue-types.mapping."10053"=3
# Epic -> Epic
%prod.jira.project-group."hibernate".issue-types.mapping."10055"=16
# Subtask -> Task
%prod.jira.project-group."hibernate".issue-types.mapping."10056"=3
# Proposal -> Task
%prod.jira.project-group."hibernate".issue-types.mapping."10057"=3
##############
%dev,test.jira.project-group."hibernate".issue-types.mapping."1"=1
%dev,test.jira.project-group."hibernate".issue-types.mapping."10054"=10054
%dev,test.jira.project-group."hibernate".issue-types.mapping."2"=2
%dev,test.jira.project-group."hibernate".issue-types.mapping."3"=3
%dev,test.jira.project-group."hibernate".issue-types.mapping."4"=4
%dev,test.jira.project-group."hibernate".issue-types.mapping."5"=5
%dev,test.jira.project-group."hibernate".issue-types.mapping."6"=6
%dev,test.jira.project-group."hibernate".issue-types.mapping."7"=3
%dev,test.jira.project-group."hibernate".issue-types.mapping."8"=8
%dev,test.jira.project-group."hibernate".issue-types.mapping."9"=9
%dev,test.jira.project-group."hibernate".issue-types.mapping."10"=10
%dev,test.jira.project-group."hibernate".issue-types.mapping."11"=11
%dev,test.jira.project-group."hibernate".issue-types.mapping."10019"=10019
%dev,test.jira.project-group."hibernate".issue-types.mapping."10020"=10020
%dev,test.jira.project-group."hibernate".issue-types.mapping."10021"=10021
%dev,test.jira.project-group."hibernate".issue-types.mapping."10052"=10052
%dev,test.jira.project-group."hibernate".issue-types.mapping."10053"=10053
%dev,test.jira.project-group."hibernate".issue-types.mapping."10055"=10055
%dev,test.jira.project-group."hibernate".issue-types.mapping."10056"=3
%dev,test.jira.project-group."hibernate".issue-types.mapping."10057"=10057
##############
#
#
# Priority:
# Major
%prod.jira.project-group."hibernate".priorities.default-value=3
# Blocker -> Blocker
%prod.jira.project-group."hibernate".priorities.mapping."1"=1
# Critical -> Critical
%prod.jira.project-group."hibernate".priorities.mapping."2"=2
# Major -> Major
%prod.jira.project-group."hibernate".priorities.mapping."3"=3
# Minor -> Normal
%prod.jira.project-group."hibernate".priorities.mapping."4"=10200
# Trivial -> Minor
%prod.jira.project-group."hibernate".priorities.mapping."5"=4
#
#
# Status:
# Status is not updated directly but only through a transition,
# hence we are mapping the status ID to a transition ID:
#
# New:
#  Open
%dev.jira.project-group."hibernate".statuses.mapping."1"=11
%prod.jira.project-group."hibernate".statuses.mapping."1"=51
#  Awaiting Test Case
%dev.jira.project-group."hibernate".statuses.mapping."10000"=11
%prod.jira.project-group."hibernate".statuses.mapping."10000"=51
#  Awaiting Response
%dev.jira.project-group."hibernate".statuses.mapping."10003"=11
%prod.jira.project-group."hibernate".statuses.mapping."10003"=1151
#  Waiting for review
%dev.jira.project-group."hibernate".statuses.mapping."10002"=11
%prod.jira.project-group."hibernate".statuses.mapping."10002"=51
#  Awaiting Contribution
%dev.jira.project-group."hibernate".statuses.mapping."10171"=11
%prod.jira.project-group."hibernate".statuses.mapping."10171"=51
#  Reopened
%dev.jira.project-group."hibernate".statuses.mapping."4"=11
%prod.jira.project-group."hibernate".statuses.mapping."4"=51
#  To Do
%dev.jira.project-group."hibernate".statuses.mapping."10100"=11
%prod.jira.project-group."hibernate".statuses.mapping."10100"=51
#  To Do
%dev.jira.project-group."hibernate".statuses.mapping."10130"=11
%prod.jira.project-group."hibernate".statuses.mapping."10130"=51
#  To Do
%dev.jira.project-group."hibernate".statuses.mapping."10168"=11
%prod.jira.project-group."hibernate".statuses.mapping."10168"=51

# In progress:
#  In Progress
%dev.jira.project-group."hibernate".statuses.mapping."3"=21
%prod.jira.project-group."hibernate".statuses.mapping."3"=31
#  In Progress
%dev.jira.project-group."hibernate".statuses.mapping."10131"=21
%prod.jira.project-group."hibernate".statuses.mapping."10131"=31
#  In Progress
%dev.jira.project-group."hibernate".statuses.mapping."10169"=21
%prod.jira.project-group."hibernate".statuses.mapping."10169"=31
#  Stalled
%dev.jira.project-group."hibernate".statuses.mapping."10141"=21
%prod.jira.project-group."hibernate".statuses.mapping."10141"=31
#  In Review
%dev.jira.project-group."hibernate".statuses.mapping."10175"=31
%prod.jira.project-group."hibernate".statuses.mapping."10175"=31
#  Review
%dev.jira.project-group."hibernate".statuses.mapping."10173"=31
%prod.jira.project-group."hibernate".statuses.mapping."10173"=31

# Closed:
#  Resolved
%dev.jira.project-group."hibernate".statuses.mapping."5"=41
%prod.jira.project-group."hibernate".statuses.mapping."5"=41
#  Closed
%dev.jira.project-group."hibernate".statuses.mapping."6"=41
%prod.jira.project-group."hibernate".statuses.mapping."6"=41
#  Done
%dev.jira.project-group."hibernate".statuses.mapping."10101"=41
%prod.jira.project-group."hibernate".statuses.mapping."10101"=41
#  Done
%dev.jira.project-group."hibernate".statuses.mapping."10170"=41
%prod.jira.project-group."hibernate".statuses.mapping."10170"=41
#  Done
%dev.jira.project-group."hibernate".statuses.mapping."10132"=41
%prod.jira.project-group."hibernate".statuses.mapping."10132"=41

#
#
# List of projects we are syncing:
# JIRATEST1 (10322) -> JIRATEST2 (10323):
# We specify only the target projects here:
%dev,test.jira.project-group."hibernate".projects.JIRATEST1.project-id=10323
%dev,test.jira.project-group."hibernate".projects.JIRATEST1.project-key=JIRATEST2
%dev,test.jira.project-group."hibernate".projects.JIRATEST1.original-project-key=JIRATEST1
%dev,test.jira.project-group."hibernate".projects.JIRATEST1.security.enabled=true
%dev,test.jira.project-group."hibernate".projects.JIRATEST1.security.secret=${JIRA_WEBHOOK_SECRET_JIRATEST1:no-secret}

#%prod.jira.project-group."hibernate".projects.JIRATEST1.project-id=12346522
#%prod.jira.project-group."hibernate".projects.JIRATEST1.project-key=OGM
#%prod.jira.project-group."hibernate".projects.JIRATEST1.original-project-key=JIRATEST1
#%prod.jira.project-group."hibernate".projects.JIRATEST1.security.enabled=true
#%prod.jira.project-group."hibernate".projects.JIRATEST1.security.secret=${JIRA_WEBHOOK_SECRET_JIRATEST1:no-secret}

# HHH (10031) -> HHH (12346325):
# https://issues.redhat.com/rest/api/2/project/HHH
# We specify only the target projects here:
%prod.jira.project-group."hibernate".projects.HHH.project-id=12346325
%prod.jira.project-group."hibernate".projects.HHH.project-key=HHH
%prod.jira.project-group."hibernate".projects.HHH.original-project-key=HHH
%prod.jira.project-group."hibernate".projects.HHH.security.enabled=${JIRA_WEBHOOK_SIGNATURE_CHECK_ENABLED:true}
%prod.jira.project-group."hibernate".projects.HHH.security.secret=${JIRA_WEBHOOK_SECRET_HHH:no-secret}
# HV (10060) -> HV (12346521):
# We specify only the target projects here:
%prod.jira.project-group."hibernate".projects.HV.project-id=12346521
%prod.jira.project-group."hibernate".projects.HV.project-key=HV
%prod.jira.project-group."hibernate".projects.HV.original-project-key=HV
%prod.jira.project-group."hibernate".projects.HV.security.enabled=${JIRA_WEBHOOK_SIGNATURE_CHECK_ENABLED:true}
%prod.jira.project-group."hibernate".projects.HV.security.secret=${JIRA_WEBHOOK_SECRET_HV:no-secret}
# HSEARCH (10061) -> HSEARCH (12346323):
# https://issues.redhat.com/rest/api/2/project/HSEARCH
# We specify only the target projects here:
%prod.jira.project-group."hibernate".projects.HSEARCH.project-id=12346323
%prod.jira.project-group."hibernate".projects.HSEARCH.project-key=HSEARCH
%prod.jira.project-group."hibernate".projects.HSEARCH.original-project-key=HSEARCH
%prod.jira.project-group."hibernate".projects.HSEARCH.security.enabled=${JIRA_WEBHOOK_SIGNATURE_CHECK_ENABLED:true}
%prod.jira.project-group."hibernate".projects.HSEARCH.security.secret=${JIRA_WEBHOOK_SECRET_HSEARCH:no-secret}
# HREACT (10321) -> HREACT (12346324):
# https://issues.redhat.com/rest/api/2/project/HREACT
# We specify only the target projects here:
%prod.jira.project-group."hibernate".projects.HREACT.project-id=12346324
%prod.jira.project-group."hibernate".projects.HREACT.project-key=HREACT
%prod.jira.project-group."hibernate".projects.HREACT.original-project-key=HREACT
%prod.jira.project-group."hibernate".projects.HREACT.security.enabled=${JIRA_WEBHOOK_SIGNATURE_CHECK_ENABLED:true}
%prod.jira.project-group."hibernate".projects.HREACT.security.secret=${JIRA_WEBHOOK_SECRET_HREACT:no-secret}
# HBX (10030) -> HBX (12346326):
# https://issues.redhat.com/rest/api/2/project/HBX
# We specify only the target projects here:
%prod.jira.project-group."hibernate".projects.HBX.project-id=12346326
%prod.jira.project-group."hibernate".projects.HBX.project-key=HBX
%prod.jira.project-group."hibernate".projects.HBX.original-project-key=HBX
%prod.jira.project-group."hibernate".projects.HBX.security.enabled=${JIRA_WEBHOOK_SIGNATURE_CHECK_ENABLED:true}
%prod.jira.project-group."hibernate".projects.HBX.security.secret=${JIRA_WEBHOOK_SECRET_HBX:no-secret}
# OGM (10160) -> OGM (12346522):
# https://issues.redhat.com/rest/api/2/project/OGM
# We specify only the target projects here:
%prod.jira.project-group."hibernate".projects.OGM.project-id=12346522
%prod.jira.project-group."hibernate".projects.OGM.project-key=OGM
%prod.jira.project-group."hibernate".projects.OGM.original-project-key=OGM
%prod.jira.project-group."hibernate".projects.OGM.security.enabled=${JIRA_WEBHOOK_SIGNATURE_CHECK_ENABLED:true}
%prod.jira.project-group."hibernate".projects.OGM.security.secret=${JIRA_WEBHOOK_SECRET_OGM:no-secret}
##############
# Deploy to OpenShift
#
quarkus.container-image.builder=jib
quarkus.openshift.part-of=replicate-jira
# Renew the SSL certificate automatically
# This requires an additional controller to run on the OpenShift cluster (in our case it does).
# See https://github.com/tnozicka/openshift-acme/#enabling-acme-certificates-for-your-object
quarkus.openshift.annotations."kubernetes.io/tls-acme"=true
quarkus.openshift.env.configmaps=replicate-jira-config
quarkus.openshift.env.secrets=replicate-jira-secrets
# Resource requirements
quarkus.openshift.resources.limits.cpu=1000m
quarkus.openshift.resources.requests.cpu=400m
quarkus.openshift.resources.limits.memory=500Mi
quarkus.openshift.resources.requests.memory=250Mi
quarkus.openshift.startup-probe.initial-delay=15S
quarkus.openshift.startup-probe.period=15S
quarkus.openshift.startup-probe.failure-threshold=48
# Declare the management port on the service
quarkus.openshift.ports."management".container-port=9000
quarkus.openshift.ports."management".host-port=90
# Don't use the version in (service) selectors,
# otherwise a rollback to an earlier version (due to failing startup) makes the service unavailable
quarkus.openshift.add-version-to-label-selectors=false
quarkus.helm.values."resources.limits.cpu".paths=(kind == Deployment).spec.template.spec.containers.resources.limits.cpu
quarkus.helm.values."resources.requests.cpu".paths=(kind == Deployment).spec.template.spec.containers.resources.requests.cpu
quarkus.helm.values."resources.limits.memory".paths=(kind == Deployment).spec.template.spec.containers.resources.limits.memory
quarkus.helm.values."resources.requests.memory".paths=(kind == Deployment).spec.template.spec.containers.resources.requests.memory
#
# General Helm config
#
# Don't just add any random system property mentioned in application.properties to values.yaml...
# We don't need it but more importantly it doesn't work (leads to marshalling errors)
# for strings that look like numbers (e.g. 2.11)
quarkus.helm.map-system-properties=false
# Set common k8s labels everywhere, even on OpenSearch resources
quarkus.helm.values."version".paths=metadata.labels.'app.kubernetes.io/version',spec.template.metadata.labels.'app.kubernetes.io/version'
quarkus.helm.values."version".property=@.app.version
quarkus.helm.values."version".value=${maven.revision}
quarkus.helm.values."part-of".paths=metadata.labels.'app.kubernetes.io/part-of',spec.template.metadata.labels.'app.kubernetes.io/part-of'
quarkus.helm.values."part-of".property=@.app.name
quarkus.helm.values."part-of".value=replicate-jira
